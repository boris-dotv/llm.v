nohup: ignoring input
Traceback (most recent call last):
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 796, in connect
    sock_and_verified = _ssl_wrap_socket_and_match_hostname(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 975, in _ssl_wrap_socket_and_match_hostname
    ssl_sock = ssl_wrap_socket(
               ^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/util/ssl_.py", line 483, in ssl_wrap_socket
    ssl_sock = _ssl_wrap_socket_impl(sock, context, tls_in_tls, server_hostname)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/util/ssl_.py", line 527, in _ssl_wrap_socket_impl
    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/home/cit_zhishuliu/miniconda3/envs/py312nano/lib/python3.12/ssl.py", line 455, in wrap_socket
    return self.sslsocket_class._create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/home/cit_zhishuliu/miniconda3/envs/py312nano/lib/python3.12/ssl.py", line 1041, in _create
    self.do_handshake()
  File "/public_hw/home/cit_zhishuliu/miniconda3/envs/py312nano/lib/python3.12/ssl.py", line 1319, in do_handshake
    self._sslobj.do_handshake()
TimeoutError: _ssl.c:993: The handshake operation timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/requests/adapters.py", line 644, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/util/retry.py", line 490, in increment
    raise reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 466, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=conn.timeout)
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/urllib3/connectionpool.py", line 367, in _raise_timeout
    raise ReadTimeoutError(
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='cas-bridge.xethub.hf.co', port=443): Read timed out. (read timeout=10)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<string>", line 5, in <module>
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/load.py", line 1412, in load_dataset
    builder_instance.download_and_prepare(
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/builder.py", line 894, in download_and_prepare
    self._download_and_prepare(
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/builder.py", line 948, in _download_and_prepare
    split_generators = self._split_generators(dl_manager, **split_generators_kwargs)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/packaged_modules/parquet/parquet.py", line 49, in _split_generators
    data_files = dl_manager.download_and_extract(self.config.data_files)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/download/download_manager.py", line 326, in download_and_extract
    return self.extract(self.download(url_or_urls))
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/download/download_manager.py", line 159, in download
    downloaded_path_or_paths = map_nested(
                               ^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 504, in map_nested
    map_nested(
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 521, in map_nested
    _single_map_nested((function, obj, batched, batch_size, types, None, True, None))
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/utils/py_utils.py", line 389, in _single_map_nested
    return [mapped_item for batch in iter_batched(data_struct, batch_size) for mapped_item in function(batch)]
                                                                                              ^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/download/download_manager.py", line 220, in _download_batched
    self._download_single(url_or_filename, download_config=download_config)
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/download/download_manager.py", line 229, in _download_single
    out = cached_path(url_or_filename, download_config=download_config)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/datasets/utils/file_utils.py", line 177, in cached_path
    ).hf_hub_download(
      ^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/hf_api.py", line 5528, in hf_hub_download
    return hf_hub_download(
           ^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1010, in hf_hub_download
    return _hf_hub_download_to_cache_dir(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1171, in _hf_hub_download_to_cache_dir
    _download_to_tmp_and_move(
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 1738, in _download_to_tmp_and_move
    http_get(
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 426, in http_get
    r = _request_wrapper(
        ^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/file_download.py", line 309, in _request_wrapper
    response = http_backoff(method=method, url=url, **params, retry_on_exceptions=(), retry_on_status_codes=(429,))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/utils/_http.py", line 310, in http_backoff
    response = session.request(method=method, url=url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/huggingface_hub/utils/_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/public_hw/share/cit_ztyu/cz/nanochat/.venv/lib/python3.12/site-packages/requests/adapters.py", line 690, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: (ReadTimeoutError("HTTPSConnectionPool(host='cas-bridge.xethub.hf.co', port=443): Read timed out. (read timeout=10)"), '(Request ID: ef835110-49f5-4a0e-ae47-a9b22754f130)')
cd /public_hw/share/cit_ztyu/cz/nanochat
source .venv/bin/activate

export HF_ENDPOINT=https://hf-mirror.com
export HF_DATASETS_CACHE=/public_hw/share/cit_ztyu/cz/nanochat/base_data/hf_datasets
export HF_HUB_DOWNLOAD_TIMEOUT=600

python -c "
from datasets import load_dataset, load_from_disk, DatasetDict

# 检查本地文件
import os, glob
for dataset_name in ['smol-smoltalk', 'mmlu', 'gsm8k']:
    path = f'/public_hw/share/cit_ztyu/cz/nanochat/base_data/hf_datasets/*{dataset_name}*'
    matches = glob.glob(path)
    print(f'{dataset_name}: found {len(matches)} paths')
    for m in matches:
        print(f'  - {os.path.basename(m)}')
        # 列出子目录
        for root, dirs, files in os.walk(m):
            print(f'    {root}: {len(dirs)} dirs, {len(files)} files')
            break  # 只看第一层
"


cd /public_hw/share/cit_ztyu/cz/nanochat
source .venv/bin/activate

python -c "
import os

# 查看每个目录的内容
for dataset_dir in [
    '/public_hw/share/cit_ztyu/cz/nanochat/base_data/hf_datasets/HuggingFaceTB___smol-smoltalk',
    '/public_hw/share/cit_ztyu/cz/nanochat/base_data/hf_datasets/cais___mmlu',
    '/public_hw/share/cit_ztyu/cz/nanochat/base_data/hf_datasets/openai___gsm8k',
]:
    print(f'\n=== {os.path.basename(dataset_dir)} ===')
    for root, dirs, files in os.walk(dataset_dir):
        level = root.count('/') - dataset_dir.count('/') + 1
        indent = '  ' * level
        print(f'{indent}{os.path.basename(root)}/')
        for f in sorted(files)[:10]:  # 只看前10个文件
            print(f'{indent}  - {f}')
        if level >= 1:  # 只看两层
            break
"